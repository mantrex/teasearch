{#
/**
 * @file
 * Entity image partial template.
 */
#}

{% if entity_type == 'user' %}
	{# User picture #}
	{% if image_field == 'user_picture' and entity.user_picture.0 %}
		{% set image_url = file_url(entity.user_picture.0.entity.fileuri) %}
	{% else %}
		{% set image_url = '/themes/custom/default/images/default-avatar.png' %}
	{% endif %}
{% else %}
	{# Node image - Debug first #}
	{% set image_url = null %}

	{% if entity[image_field] and entity[image_field].0 %}
		{% if entity[image_field].0.entity %}
			{% set image_url = file_url(entity[image_field].0.entity.fileuri) %}
		{% elseif entity[image_field].0.target_id %}
			{% set file = drupal_entity('file', entity[image_field].0.target_id) %}
			{% if file %}
				{% set image_url = file_url(file.fileuri) %}
			{% endif %}
		{% endif %}
	{% endif %}

	{% if not image_url %}
		{% set image_url = '/themes/custom/default/images/default-person.png' %}
	{% endif %}
{% endif %}

<img src="{{ image_url }}" alt="{{ entity.label }}" class="entity-image {{ image_format == 'rounded' ? 'rounded-circle' : 'rounded' }}" loading="lazy" onerror="this.src='/themes/custom/default/images/placeholder.png'; this.onerror=null;">
